import{Registry}from"./registry.0de615f8.js";class Player{static get audio(){if(void 0===this._audio){this._audio=document.createElement("audio"),this._audio.setAttribute("id","cnn-audio"),this._audio.setAttribute("preload","none"),this._audio.progress=0,this._audio.playlist=null,this._audio.position=null,this._audio.metadata={},document.body.appendChild(this._audio),this._audio.addEventListener("loadstart",this.onLoadStart.bind(this)),this._audio.addEventListener("timeupdate",this.onTimeUpdate.bind(this)),this._audio.addEventListener("playing",this.onPlaying.bind(this)),this._audio.addEventListener("play",this.onPlaying.bind(this)),this._audio.addEventListener("pause",this.onPause.bind(this)),this._audio.addEventListener("ended",this.onEnded.bind(this)),this._audio.addEventListener("ended",this.onNext.bind(this));try{navigator.mediaSession.setActionHandler("play",this.onPlayActionHandler.bind(this)),navigator.mediaSession.setActionHandler("pause",this.onPauseActionHandler.bind(this)),navigator.mediaSession.setActionHandler("previoustrack",this.onPrevious.bind(this)),navigator.mediaSession.setActionHandler("nexttrack",this.onNext.bind(this))}catch(i){}void 0===this._audioId&&(this._audioId=Math.floor(Math.random()*Math.floor(999999)));const i=new CustomEvent("CNN_AUDIO_READY",{detail:this._audio});window.dispatchEvent(i)}return this._audio}static get audioId(){return this._audioId}static onLoadStart(i){Registry.resetStatus(),this.audioPlayer.status="loading"}static onPlaying(i){this.audioPlayer.status="playing"}static onPause(i){this.audioPlayer.status="paused"}static onEnded(i){Registry.resetStatus()}static onTimeUpdate(i){const t=Math.floor(this.audio.currentTime/this.audio.duration*100);this.audio.progress=Number.isNaN(t)?0:t}static onPrevious(i){const t=Registry.getPreviousTrack(this.audio.playlist,this.audio.playerPosition,this.audio.trackPosition);null!==t&&t.play()}static onNext(i){const t=Registry.getNextTrack(this.audio.playlist,this.audio.playerPosition,this.audio.trackPosition);null!==t&&t.play()}static onPlayActionHandler(i){this.audio.play()}static onPauseActionHandler(i){this.audio.pause()}static play(i){this.audioPlayer=i,this.audio.src!==i.activeTrack.url&&""!==this.audio.src&&this.audio.dispatchEvent(new CustomEvent("sourcechange",{detail:{oldsrc:this.audio.src}})),this.audio.src=i.activeTrack.url,this.audio.metadata=i.activeTrack,this.audio.playerId=i.playerId,this.audio.playlist=i.playlist,this.audio.playerPosition=i.position,this.audio.trackPosition=i.activeTrackPosition,this.audio.load();try{navigator.mediaSession.metadata=new MediaMetadata({title:i.activeTrack.title,artist:i.activeTrack.author,artwork:[{src:i.activeTrack.image.medium,sizes:"600x600"},{src:i.activeTrack.image.large,sizes:"1000x1000"},{src:i.activeTrack.image.original,sizes:"3000x3000"}]})}catch(i){console.log(i)}this.audio.play()}static pause(i){this.audioPlayer=i,this.audio.pause()}static resume(i){this.audioPlayer=i,this.audio.play()}}export{Player};